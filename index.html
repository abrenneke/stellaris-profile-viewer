<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://abrenneke.github.io/stellaris-profile-viewer" />
    <meta property="og:title" content="Stellaris Profile Viewer" />
    <meta
      property="og:description"
      content="Tool to visualize the script_profiling.log files that Stellaris generates."
    />
    <meta property="og:image" content="https://abrenneke.github.io/stellaris-profile-viewer/screenshot.png" />

    <title>Stellaris Profile Viewer</title>
    <meta
      name="description"
      content="View Stellaris script profiling log files in a user-friendly and organized manner with Stellaris Profile Viewer. Simply upload your log file and wait for the tool to generate a breakdown of your code's performance, including detailed statistics on execution time, parent-child relationships, and more."
    />
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link href="./index.css" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="./stellaris.ico" />
    <script src="./index.js" defer type="module"></script>
  </head>

  <body>
    <div id="wrapper">
      <div id="container">
        <div id="toolbar">
          <div id="left-toolbar">
            <label class="button" id="toolbar-select-file-button" for="file">Select File</label>
            <div class="toolbar-dropdown">
              <label for="root-items-select">Show:</label>
              <select id="root-items-select">
                <option value="10">10</option>
                <option value="50">50</option>
                <option value="100" selected>100</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
              </select>
            </div>
            <div class="toolbar-checkbox">
              <input type="checkbox" id="show-other-percent-checkbox">
              <label for="show-other-percent-checkbox">Other %</label>
              <i class="fas fa-circle-question after-tooltip" data-tooltip="If you know what 'Other %' means, please let me know!"></i>
            </div>
          </div>
          <div id="center-toolbar">
            <div class="toolbar-statistic">
              <span>Total Entries:</span>
              <span id="total-entries" class="tooltip-value">0</span>
            </div>
            <div class="toolbar-statistic">
              <span>Total Roots:</span>
              <span id="total-roots" class="tooltip-value">0</span>
            </div>
            <div class="toolbar-statistic">
              <span>Total Time:</span>
              <span id="total-time" class="tooltip-value">0ms</span>
              <span class="tooltip" id="total-time-tooltip" class="tooltip"></span>
            </div>
          </div>
          <div id="right-toolbar">
            <button class="button" id="export-json-button"><i class="fas fa-download"></i> Export JSON</button>
            <button class="button" id="export-nested-json-button">
              <i class="fas fa-sitemap"></i> Export JSON (Nested)
            </button>
            <a href="https://github.com/abrenneke/stellaris-profile-viewer"
              ><img src="./github-mark-white.svg" alt="GitHub Repository" />
            </a>
          </div>
        </div>

        <div id="table-container"></div>
        <div id="spinner-container">
          <div class="spinner"></div>
        </div>
        <div id="entry-container">
          <h1>Stellaris Profile Viewer</h1>
          <section id="select-file-section">
            <p>
              This tool will help you view
              <span class="mono">script_profiling.log</span> files. To get started, simply select your log file using
              the button below and wait.
            </p>
            <label class="button" for="file">Select File</label>
            <input type="file" id="file" accept=".log" />
            <p>This process is entirely client-side.</p>
          </section>
          <section id="how-to-profile-section">
            <h2>How to Profile Mod Scripts</h2>
            <p>
              If you're experiencing lag while playing Stellaris, it's possible that one or more mods are causing
              performance issues. To help identify the culprit, you can use the Stellaris Profile Viewer to analyze the
              log file generated by the game's script profiler. This log file contains information about the execution
              time of various scripts and can help pinpoint which mod or script is causing the lag. Follow the steps
              below to generate and analyze the log file:
            </p>
            <ol>
              <li>Open the console with the <kbd>~</kbd> key</li>
              <li>Run the command <code>script_profiler</code></li>
              <li>Wait a couple months in game</li>
              <li>Run the command <code>script_profiler</code> again</li>
              <li>
                Find
                <code>Documents\Paradox Interactive\Stellaris\logs\script_profiling.log</code>
              </li>
            </ol>
          </section>
        </div>

        <div id="error-container">
          <div class="error-message-container">
            <h2>Error</h2>
            <pre id="error-message">
              There was an error parsing the log file. Please make sure the file is in the correct format and try again.
            </pre>
          </div>
          <div id="try-again-container">
            <button class="button" id="try-again">Try Again</button>
          </div>
          <p id="help">
            If you are encountering an error and the app can't parse your log file, please reach out to me on Discord at
            Snea#5133 over on the <a href="https://discord.gg/bHVez2C">Stellaris Modding Den</a>, and attach your
            <code>script_profiling.log</code> file (you should probably zip it up first too). Thanks!
          </p>
        </div>
      </div>

      <div id="footer">
        <div class="disclaimer">
          <p>
            Full disclosure, this app was created for fun with assistance from ChatGPT, an AI language model developed
            by OpenAI.
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
